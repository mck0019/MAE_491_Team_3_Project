<!DOCTYPE html>
<html>

<head>
  <title>MAE 491 Interface</title>
</head>

<link rel="icon" href="data:,">

<style>
  body {
    background: #202020;
    color: rgb(255, 255, 255);
    display: flex;
    justify-content: center;
    align-items: center;
    text-align: center;
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
  }

  .container {
    position: absolute;
    top: 50vh;
    left: 50vw;
    height: 75vh;
    width: 75vw;
    margin-top: -37.5vh;
    margin-left: -37.5vw;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(8, 1fr);
    grid-gap: 3rem;
  }

  .item {
    font-family: 'Consolas';
    text-shadow: 0.05em 0.08em black;
    border-radius: 1.5vw;
  }

  .button {
    color: white;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    cursor: pointer;
  }

  .title {
    font-size: 3rem;
    grid-column-start: 1;
    grid-column-end: 4;
    grid-row: 1;
  }

  .panel {
    font-size: 1.5em;
    background-color: #333333;
    box-shadow: 0 16px #181818;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .start {
    background-color: rgb(98, 173, 80);
    box-shadow: 0 16px rgb(64, 112, 51);
    grid-column: 3;
    grid-row: 2;
  }

  .start:active {
    transform: translateY(8px);
    box-shadow: 0 8px rgb(64, 112, 51);
  }

  .stop {
    background-color: rgb(168, 64, 50);
    box-shadow: 0 16px rgb(104, 38, 30);
    grid-column: 3;
    grid-row: 3;
  }

  .stop:active {
    transform: translateY(8px);
    box-shadow: 0 8px rgb(104, 38, 30);
  }

  .download {
    background-color: rgb(207, 167, 57);
    box-shadow: 0 16px rgb(138, 111, 38);
    grid-column: 3;
    grid-row: 4;
  }

  .download:active {
    transform: translateY(8px);
    box-shadow: 0 8px rgb(138, 111, 38);
  }

  .input {
    grid-column-start: 1;
    grid-column-end: 3;
    grid-row-start: 2;
    grid-row-end: 5;
  }

  .angle {
    grid-column-start: 1;
    grid-column-end: 2;
    grid-row-start: 5;
    grid-row-end: 7;
  }

  .velocity {
    grid-column-start: 2;
    grid-column-end: 3;
    grid-row-start: 5;
    grid-row-end: 7;
  }

  .controller {
    grid-column-start: 3;
    grid-column-end: 4;
    grid-row-start: 5;
    grid-row-end: 7;
  }

  .slider {
    -webkit-appearance: none;
    appearance: none;
    width: 50%;
    height: 20px;
    border-radius: 15px;
    background: #545454;
    outline: none;
  }

  .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #1d5aaa;
    cursor: pointer;
  }

  .slider_text {}
</style>

<body>

  <div class="container">

    <!-- Title -->
    <div class="item title">MAE 491 Interface</div>

    <!-- Input Panel -->
    <div class="item panel input">
      Input Angle:
      <input type="range" class="slider" id="slider" min="-180" max="180" oninput="update_text_input(this.value)">
      <input type="number" class="slider_text" id="text-input" min="-180" max="180" oninput="update_slider(this.value)">
    </div>

    <!-- Buttons -->
    <button class="item button start" onclick="send_start()">Start</button>
    <button class="item button stop" onclick="send_stop()">Stop</button>
    <button class="item button download">Download</button>

    <!-- Output Panel -->
    <div class="item panel angle">
      Angle
      <p id="angle_output">-</p><p>&#xb0;</p>
    </div>
    <div class="item panel velocity">
      Velocity
      <p id="angular_vel_output">-</p><p>&#xb0;/s</p>
    </div>
    <div class="item panel controller"></div>

  </div>

  <script>

    function update_text_input(val) {
      document.getElementById('text-input').value = val;
      socket.send(val);
    }

    function update_slider(val) {
      if (val < -180) {
        val = -180;
      } else if (val > 180) {
        val = 180;
      }
      document.getElementById('slider').value = val;
      socket.send(val);
    }

    function send_start() {
    console.log("START")
        if(socket.readyState === socket.OPEN) {
          socket.send("Start");
        }
    }
    function send_stop() {
        if(socket.readyState === socket.OPEN) {
            socket.send("Stop");
        }
    }

    var socket = new WebSocket('ws://192.168.4.1:80/ws');


    let angle_output = document.querySelector('#angle_ouput');
    let angular_vel_output = document.querySelector('#angle_ouput');
    
    socket.onopen = function(event) {
      console.log('Connected to server');
    };

    socket.onmessage = function(event) {
      //console.log('Received data: ' + event.data);
    };

    socket.onclose = function(event) {
      console.log('Disconnected from server');
    };


    setInterval(function() {
        if(socket.readyState === socket.OPEN) {
            socket.send("update");
        }
    }, 50);


  </script>
</body>

</html>